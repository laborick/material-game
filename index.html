<!DOCTYPE html>
<htm lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">

<title>Material Atelier</title>

<style>

body{
 margin:0;
 background:#fafaf7;
 font-family:"Helvetica Neue","Yu Gothic","Hiragino Kaku Gothic ProN",sans-serif;
 text-align:center;
 color:#222;
}

h1{
 font-weight:300;
 letter-spacing:0.1em;
 margin:14px 0 2px;
 font-size:24px;
}

#mission{
 font-size:14px;
 letter-spacing:0.2em;
 color:#777;
 margin-bottom:6px;
}

#top{
 position:relative;
 width:360px;
 margin:0 auto;
}

 #time{
 position:absolute;
 top:6px;
 left:50%;
 transform:translateX(-50%);
 font-size:18px;
 background:rgba(255,255,255,0);
 padding:4px 14px;
 border-radius:14px;
 z-index:5;
}

#score{
 font-size:18px;
 margin:6px 0;
}

canvas{
 background:#fff;
 border:1px solid #ccc;
 display:block;
 margin:0 auto;
 border-radius:8px;
}

button{
 margin:12px;
 padding:12px 28px;
 border:none;
 background:#333;
 color:#fff;
 border-radius:22px;
 font-size:15px;
 letter-spacing:0.08em;
}

 z-index:10;
}

.resultBox{
 width:82%;
 background:#fff;
 border:2px solid #ddd;
 border-radius:18px;
 padding:24px 20px;
 box-shadow:0 8px 20px rgba(0,0,0,0.15);
}

.resultTitle{
 font-size:20px;
 margin-bottom:10px;
}

.resultMaterial{
 font-size:22px;
 margin-bottom:10px;
}

.resultText{
 font-size:15px;
 line-height:1.5;
 color:#444;
 margin-bottom:12px;
}

.resultRecommend{
 font-weight:bold;
 margin-top:8px;
}

.resultLink{
 display:inline-block;
 margin-top:6px;
 color:#333;
 text-decoration:underline;
}

</style>
</head>

<body>

 const ctx = canvas.getContext("2d");

let state="ready";
let time=10;
let timer=0;
let parts=[];
let dominant=null;

let score={
 cotton:0,
 wool:0,
 linen:0
};

const avatar={
 x:180,
 y:350,
 scale:1.45
};

ã€€"å¯’å†·åœ°ã®æš®ã‚‰ã—ã¨ã¨ã‚‚ã«ç™ºå±•ã—ã€ç™»å±±å®¶ã«ã‚‚æ„›ã•ã‚Œã‚‹å¤©ç„¶ç´ æã§ã™ã€‚",
  "ã‚¹ãƒ¼ãƒ„æ–‡åŒ–ã¯ä¸­ä¸–ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘çµŒæ¸ˆã‚’æ”¯ãˆãŸç¾Šæ¯›ã¨å…±ã«è‚²ã¡ã¾ã—ãŸã€‚"
 ],
 item:"DRIVER COAT",
 url:"https://laborick.official.ec/items/125765688"
},

{
 name:"linen",
 label:"éº»",
 emoji:"ðŸŒ¿",
 color:"#7fcf9a",
 msg:[
  "å¤ä»£ã‚¨ã‚¸ãƒ—ãƒˆçŽ‹æ—ã‚‚ç”¨ã„ãŸéº»ã¯ã€ç”Ÿæ´»å¸ƒã¨ã—ã¦é•·ãæ„›ã•ã‚Œã¦ãã¾ã—ãŸã€‚",
  "16ã€œ18ä¸–ç´€ãƒ¨ãƒ¼ãƒ­ãƒƒãƒ‘ã§ã®ãƒªãƒãƒ³ã¯ã€æœªæ¥ã®æš®ã‚‰ã—ã‚’é¡˜ã£ã¦å«å…¥ã‚Šé“å…·ã«é¸ã°ã‚Œã¦ã„ã¾ã—ãŸã€‚"
 ],
 item:"INDIGOÃ—HEMP / Band collar shirt",
 url:"https://laborick.official.ec/items/118656393"
}

];

 // ================= Utils =================

function resetCtx(){
 ctx.setTransform(1,0,0,1,0,0);
 ctx.globalAlpha = 1;
 ctx.shadowBlur = 0;
}

// ================= Spawn =================

function spawn(){

 const m = materials[Math.floor(Math.random()*3)];

 parts.push({
  x:Math.random()*(canvas.width-30)+15,
  y:-20,
  v:2+Math.random()*2,
  mat:m
 });

}


// ================= Avatar =================

function drawAvatar(){

 resetCtx();

 const s = avatar.scale;

 ctx.lineWidth=2;
 ctx.strokeStyle="#000";
 ctx.fillStyle="#222";

 /* Head */
 ctx.beginPath();
 ctx.arc(avatar.x,avatar.y-32*s,12*s,0,Math.PI*2);
 ctx.fill();
 ctx.stroke();

 /* Body */
 ctx.fillRect(avatar.x-7*s,avatar.y-18*s,14*s,44*s);
 ctx.strokeRect(avatar.x-7*s,avatar.y-18*s,14*s,44*s);

 /* Arms */
 ctx.fillRect(avatar.x-28*s,avatar.y-4*s,20*s,6*s);
 ctx.fillRect(avatar.x+8*s,avatar.y-4*s,20*s,6*s);

 ctx.strokeRect(avatar.x-28*s,avatar.y-4*s,20*s,6*s);
 ctx.strokeRect(avatar.x+8*s,avatar.y-4*s,20*s,6*s);

 /* Legs */
 ctx.fillRect(avatar.x-7*s,avatar.y+24*s,7*s,26*s);
 ctx.fillRect(avatar.x+2*s,avatar.y+24*s,7*s,26*s);

 ctx.strokeRect(avatar.x-7*s,avatar.y+24*s,7*s,26*s);
 ctx.strokeRect(avatar.x+2*s,avatar.y+24*s,7*s,26*s);

 resetCtx();
}


// ================= Clothes =================

function drawClothes(){

 if(!dominant) return;

 const s = avatar.scale;

 ctx.lineWidth=2;
 ctx.fillStyle=dominant.color;
 ctx.strokeStyle="#000";


// ================= Parts =================

function drawPart(p){
 ctx.font="22px serif";
 ctx.fillText(p.mat.emoji,p.x-8,p.y+8);
}

 
// ================= Hit =================

function hit(p){

 return(
  p.x>avatar.x-26 &&
  p.x<avatar.x+26 &&
  p.y>avatar.y-46 &&
  p.y<avatar.y+50
 );

}


// ================= Score =================

function updateScore(){

 document.getElementById("score").innerText=
 `â˜ï¸ ç¶¿:${score.cotton}ã€€ðŸ‘ ç¾Šæ¯›:${score.wool}ã€€ðŸŒ¿ éº»:${score.linen}`;

}

// ================= Result =================

function showFinalMessage(mat){

 const text =
  mat.msg[Math.floor(Math.random()*mat.msg.length)];

 document.querySelector(".resultMaterial").innerText=
 `âœ¨ã€ ${mat.emoji} ${mat.label}  ã€‘âœ¨`;

 document.querySelector(".resultText").innerText = text;

 document.querySelector(".resultRecommend").innerText =
 `ãŠã™ã™ã‚ã®1ç€ï¼š${mat.item}`;

 const link = document.querySelector(".resultLink");

 link.innerText = "å•†å“ãƒšãƒ¼ã‚¸ â†’";
 link.href = mat.url;

 document.getElementById("resultCard").style.display="flex";

}

// ================= Loop =================

function loop(){

 ctx.clearRect(0,0,canvas.width,canvas.height);

 if(state==="playing"){

  drawAvatar();

  parts.forEach((p,i)=>{

   p.y+=p.v;
   drawPart(p);

   if(hit(p)){
    score[p.mat.name]++;
    updateScore();
    parts.splice(i,1);
   }

  });

  timer++;

  if(timer>40){
   spawn();
   timer=0;
  }

  if(time<=0) finish();

 }

 if(state==="end"){
  drawAvatar();
  drawClothes();
 }

 requestAnimationFrame(loop);

}

// ================= Timer =================

setInterval(()=>{

 if(state==="playing"){
  time--;
  document.getElementById("time").innerText=time+"s";
 }

},1000);


// ================= Finish =================

function finish(){

 if(state==="end") return;

 state="end";

 let max=0;

 materials.forEach(m=>{
  if(score[m.name]>max){
   max=score[m.name];
   dominant=m;
  }
 });

 if(dominant) showFinalMessage(dominant);

}

// ================= Control =================

let touch=false;

canvas.addEventListener("touchstart",()=>touch=true);
canvas.addEventListener("touchend",()=>touch=false);

canvas.addEventListener("touchmove",(e)=>{

 if(!touch) return;

 const r=canvas.getBoundingClientRect();

 avatar.x =
  e.touches[0].clientX - r.left;

});


// ================= Start =================

document.getElementById("startBtn").onclick=()=>{

 state="playing";
 time=10;
 parts=[];
 timer=0;
 dominant=null;

 score={
  cotton:0,
  wool:0,
  linen:0
 };

 updateScore();

 document.getElementById("time").innerText="10s";
 document.getElementById("resultCard").style.display="none";

};


loop();

</script>

</body>
</html>
   
