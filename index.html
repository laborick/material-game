<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">

<title>Material Atelier</title>

<style>

body{
 margin:0;
 background:#fafaf7;
 font-family:"Helvetica Neue","Yu Gothic","Hiragino Kaku Gothic ProN",sans-serif;
 text-align:center;
 color:#222;
}

h1{
 font-weight:300;
 letter-spacing:0.1em;
 margin:14px 0 2px;
 font-size:24px;
}

#mission{
 font-size:14px;
 letter-spacing:0.2em;
 color:#777;
 margin-bottom:6px;
}

#top{
 position:relative;
 width:360px;
 margin:0 auto;
}

#time{
 position:absolute;
 top:6px;
 left:50%;
 transform:translateX(-50%);
 font-size:18px;
 background:rgba(255,255,255,0.8);
 padding:4px 14px;
 border-radius:14px;
 box-shadow:0 0 3px rgba(0,0,0,0.1);
 z-index:5;
}

#score{
 font-size:18px;
 margin:6px 0;
}

canvas{
 background:#fff;
 border:1px solid #ddd;
 display:block;
 margin:0 auto;
 border-radius:8px;
}

button{
 margin:12px;
 padding:12px 28px;
 border:none;
 background:#333;
 color:#fff;
 border-radius:22px;
 font-size:15px;
 letter-spacing:0.08em;
}

/* ===== Result ===== */

#resultCard{
 position:absolute;
 top:0;
 left:0;
 width:100%;
 height:100%;
 background:rgba(255,255,255,0);
 display:none;
 justify-content:center;
 align-items:flex-start;
 padding-top:50px;
 z-index:10;
}

.resultBox{
 width:82%;
 background:#fff;
 border:1px solid #ddd;
 border-radius:18px;
 padding:26px 22px;
 box-shadow:0 10px 24px rgba(0,0,0,0.15);
}

.resultTitle{
 font-size:20px;
 letter-spacing:0.2em;
 margin-bottom:14px;
}

.resultMaterial{
 font-size:22px;
 margin-bottom:12px;
}

.resultText{
 font-size:16px;
 line-height:1.6;
 color:#444;
}

</style>
</head>

<body>

<h1>MATERIAL ATELIER</h1>
<div id="mission">Á¥†ÊùêÈõÜ„ÇÅ</div>

<div id="score">
‚òÅÔ∏è Á∂ø:0„ÄÄüêë ÁæäÊØõ:0„ÄÄüåø È∫ª:0
</div>

<button id="startBtn">START</button>

<div id="top">

 <div id="time">15s</div>

 <canvas id="game" width="360" height="450"></canvas>

 <div id="resultCard">
  <div class="resultBox">

   <div class="resultTitle">‚ú® „Éè„Ç§„Çπ„Ç≥„Ç¢ ‚ú®</div>
   <div class="resultMaterial"></div>
   <div class="resultText"></div>

  </div>
 </div>

</div>

<script>

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let state="ready";
let time=15;
let timer=0;
let parts=[];
let dominant=null;

let score={
 cotton:0,
 wool:0,
 linen:0
};

const avatar={
 x:180,
 y:350,
 scale:1.44
};

const materials=[

{
 name:"cotton",
 label:"Á∂ø",
 emoji:"‚òÅÔ∏è",
 color:"#9fc5ff",
 msg:[
  "‰∏ñÁïå„ÅßÊúÄ„ÇÇË∫´Ëøë„Å™Â§©ÁÑ∂ÁπäÁ∂≠„ÄÇ",
  "Ê¥ó„ÅÜÊñáÂåñ„ÇíÂ∫É„Åí„Åü„ÅÆ„Åå„Ç≥„ÉÉ„Éà„É≥„ÄÇ",
  "19‰∏ñÁ¥Ä„ÄÅÁ∂ø„ÅØ‰∏ñÁïå„ÇíÁπã„ÅêÁî£Ê•≠„ÅÆ‰∏≠ÂøÉ„Å†„Å£„Åü„ÄÇ",
  "‰ªä„Åß„ÇÇÂåªÁôÇÁî®„Ç¨„Éº„Çº„Å´‰Ωø„Çè„Çå„ÇãÁ¥†Êùê"
 ] 
},

{
 name:"wool",
 label:"ÁæäÊØõ",
 emoji:"üêë",
 color:"#e2b980",
 msg:[
  "‰∏≠‰∏ñ„É®„Éº„É≠„ÉÉ„ÉëÁµåÊ∏à„ÇíÊîØ„Åà„ÅüÁæäÊØõ„ÄÇ",
  "ÁôªÂ±±ÂÆ∂„Å´„ÇÇÊÑõ„Åï„Çå„ÇãÂ§©ÁÑ∂Á¥†Êùê„ÄÇ",
  "Â§©ÁÑ∂„ÅÆÊ∏©Â∫¶Ë™øÊï¥Ê©üËÉΩ„ÇíÊåÅ„Å§„ÄÇ",
  "„Çπ„Éº„ÉÑÊñáÂåñ„ÅØÁæäÊØõ„Å®ÂÖ±„Å´ËÇ≤„Å£„Åü„ÄÇ"
 ]
},

{
 name:"linen",
 label:"È∫ª",
 emoji:"üåø",
 color:"#7fcf9a",
 msg:[
  "Âè§‰ª£„Ç®„Ç∏„Éó„ÉàÁéãÊóè„ÇÇÊÑõÁî®„ÄÇ",
  "„Ç≠„ÉÉ„ÉÅ„É≥„Åß„ÇÇÊ¥ªË∫ç„ÄÅÈÄöÊ∞óÊÄßÊäúÁæ§„ÅÆÊ∏ÖÊΩîÁ¥†Êùê„ÄÇ",
  "„Éü„Ç§„É©„ÇÇÈ∫ª„Å´ÂåÖ„Åæ„Çå„Å¶„ÅÑ„Åü„ÄÇ",
  "„É®„Éº„É≠„ÉÉ„Éë„Åß„ÅØÁµêÂ©öÈÅìÂÖ∑„Å´È∫ª„ÇíÂÖ•„Çå„Åü„ÄÇ"
 ]
}

];


// ================= Utils =================

function resetCtx(){

 ctx.setTransform(1,0,0,1,0,0);
 ctx.globalAlpha = 1;
 ctx.shadowBlur = 0;
 ctx.shadowColor = "transparent";

}


// ================= Spawn =================

function spawn(){

 const m = materials[Math.floor(Math.random()*3)];

 parts.push({
  x:Math.random()*(canvas.width-30)+15,
  y:-20,
  v:2+Math.random()*2,
  mat:m
 });

}


// ================= Avatar =================

function drawAvatar(){

 resetCtx();

 const s = avatar.scale;

 ctx.shadowColor="rgba(0,0,0,0.25)";
 ctx.shadowBlur=6;

 ctx.fillStyle="#222";

 ctx.beginPath();
 ctx.arc(avatar.x,avatar.y-32*s,12*s,0,Math.PI*2);
 ctx.fill();

 ctx.fillRect(avatar.x-7*s,avatar.y-18*s,14*s,44*s);

 ctx.fillRect(avatar.x-28*s,avatar.y-4*s,20*s,6*s);
 ctx.fillRect(avatar.x+8*s,avatar.y-4*s,20*s,6*s);

 ctx.fillRect(avatar.x-7*s,avatar.y+24*s,7*s,26*s);
 ctx.fillRect(avatar.x+2*s,avatar.y+24*s,7*s,26*s);

 resetCtx();
}


// ================= Clothes =================

function drawClothes(){

 if(!dominant) return;

 resetCtx();

 const s = avatar.scale;

 ctx.fillStyle = dominant.color;
 ctx.strokeStyle = "#333";
 ctx.lineWidth = 2;

 ctx.beginPath();
 ctx.roundRect(
  avatar.x-24*s,
  avatar.y-28*s,
  48*s,
  64*s,
  14*s
 );
 ctx.fill();
 ctx.stroke();

 ctx.beginPath();

 ctx.roundRect(
  avatar.x-42*s,
  avatar.y-16*s,
  18*s,
  26*s,
  7*s
 );

 ctx.roundRect(
  avatar.x+24*s,
  avatar.y-16*s,
  18*s,
  26*s,
  7*s
 );

 ctx.fill();
 ctx.stroke();

 ctx.fillStyle="#111";
 ctx.font=`bold ${11*s}px Arial`;
 ctx.textAlign="center";
 ctx.textBaseline="middle";

 ctx.fillText(
  "LABORICK",
  avatar.x,
  avatar.y
 );

 resetCtx();
}


// ================= Parts =================

function drawPart(p){

 resetCtx();

 ctx.font="22px serif";
 ctx.fillText(p.mat.emoji,p.x-8,p.y+8);

}


// ================= Hit =================

function hit(p){

 return(
  p.x>avatar.x-26 &&
  p.x<avatar.x+26 &&
  p.y>avatar.y-46 &&
  p.y<avatar.y+50
 );

}


// ================= Score =================

function updateScore(){

 document.getElementById("score").innerText=
 `‚òÅÔ∏è Á∂ø:${score.cotton}„ÄÄüêë ÁæäÊØõ:${score.wool}„ÄÄüåø È∫ª:${score.linen}`;

}


// ================= Result =================

function showFinalMessage(mat){

 const text =
  mat.msg[Math.floor(Math.random()*mat.msg.length)];

 document.querySelector(".resultMaterial").innerText=
 `„Äê ${mat.emoji} ${mat.label} „Äë`;

 document.querySelector(".resultText").innerText = text;

 document.getElementById("resultCard").style.display="flex";

}


// ================= Loop =================

function loop(){

 resetCtx();

 ctx.clearRect(0,0,canvas.width,canvas.height);

 if(state==="playing"){

  drawAvatar();

  parts.forEach((p,i)=>{

   p.y+=p.v;
   drawPart(p);

   if(hit(p)){

    score[p.mat.name]++;
    updateScore();
    parts.splice(i,1);

   }

  });

  timer++;

  if(timer>42){
   spawn();
   timer=0;
  }

  if(time<=0) finish();

 }

 if(state==="end"){

  drawAvatar();
  drawClothes();

 }

 requestAnimationFrame(loop);

}


// ================= Timer =================

setInterval(()=>{

 if(state==="playing"){

  time--;
  document.getElementById("time").innerText=time+"s";

 }

},1000);


// ================= Finish =================

function finish(){

 if(state==="end") return;

 state="end";

 let max=0;

 materials.forEach(m=>{

  if(score[m.name]>max){
   max=score[m.name];
   dominant=m;
  }

 });

 if(dominant) showFinalMessage(dominant);

}


// ================= Control =================

let touch=false;

canvas.addEventListener("touchstart",()=>touch=true);
canvas.addEventListener("touchend",()=>touch=false);

canvas.addEventListener("touchmove",(e)=>{

 if(!touch) return;

 const r=canvas.getBoundingClientRect();

 avatar.x =
  e.touches[0].clientX - r.left;

});


// ================= Start =================

document.getElementById("startBtn").onclick=()=>{

 state="playing";
 time=15;
 parts=[];
 timer=0;
 dominant=null;

 score={
  cotton:0,
  wool:0,
  linen:0
 };

 updateScore();

 document.getElementById("time").innerText="15s";
 document.getElementById("resultCard").style.display="none";

};


loop();

</script>

</body>
</html>
